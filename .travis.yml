language: cpp

arch: amd64
os: linux
dist: focal

env:
  global:
  - secure: "iojZaR7ZxX1WHyf+ZoSxVuJjkqAOK3z/fwCmVsb3YczCmghDJlMLItuAFp8YiqQD//k0rvdQm7TC2pM5kZNwx/+PREhoTekr4gJtzC8iS/KCQl/2HjAU2Zhe14iNxlnQ4mfeYyFZduoOjihmWGKTNpzMDDO6Aa8eG+8ZvzmrMLgIZiHgJarW9p00oH0K+TH9vzUzfUwAp9N0MMKL8T6QGuHMNH9OhdNxfMa06CK1FvqCf1Vn/NHVS+CAB1cfJFUqA8JnJJJ6Qt+lKeCR/ay63sS3idYC27wTRfgdYLk7nXVx4QcxRbj4Ehd34SVXPTr6ck7yMkzZvqK0VC5zM7X1cG+DlHccl4Xz2lmRutnVbqLsPi2NAPOuz2/L5+sx3Lv08ePaqYcWXnmi4fNqfvjkhx9PIHEmhz89lGIJ24F94HLVKpX5K6jnNF9ezst9teybXesk73k9iN8KrVwAxAyA3koHQ4GwWUdcc8bUzfIfLGY97I1CPupGhmrAhYKvOZhdj8f+LYZ/q2ps/nqgeEj+g5GWXcqmwDX55+XKl3GqjdfzEHyWYmjwApILWowJXH7QHkGzsER7U6leE5e38ybLIq9mjXGFUdxWI+QhzJHpXeiSJtHnQtoF3ueIKZ4/C1zDaoXq6vAikjc0Hy9uonRZyH0GHk4gH2yi0T9PTSWv14s="

before_install:
  - echo -n | openssl s_client -connect https://scan.coverity.com:443 | sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p' | sudo tee -a /etc/ssl/certs/ca-


jobs:
  include:
    compiler: gcc
    before_install:
      - sudo apt-get update
      - sudo apt-get -y install libgtk-3-dev meson libgtk-layer-shell-dev
      - wget https://github.com/vstakhov/libucl/archive/0.8.1.tar.gz -O /tmp/libucl.tgz
      - pushd /tmp
      - tar -xvf libucl.tgz
      - cd libucl-0.8.1
      - ./autogen.sh
      - ./configure
      - make
      - sudo make install
      - popd
    script:
      - meson build
      - ninja -C build

addons:
  coverity_scan:
    project:
      name: "LBCrion/sfwbar"
      description: "SFWBar"
    notification_email: harley@hosers.org
    build_command_prepend: "meson build"
    build_command: "ninja -C build"
    branch_pattern: coverity
